bundle:
  name: oos-workflow

# Define wheel artifact
artifacts:
  default:
    type: whl
    path: dist/oos_workflow-0.1.0-py3-none-any.whl

# Define Databricks resources
resources:
  jobs:
    oos_workflow_job:
      name: "OOS Workflow Job"
      
      # Define ephemeral job cluster
      job_clusters:
        - job_cluster_key: "oos_cluster"
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "Standard_DS3_v2"
            num_workers: 1
            spark_conf:
              "spark.databricks.cluster.profile": "singleNode"
              "spark.master": "local[*]"
            custom_tags:
              "project": "oos-workflow"
              "environment": "dev"
      
      # Define workflow tasks
      tasks:
        - task_key: "run_workflow"
          job_cluster_key: "oos_cluster"
          
          # Python wheel task configuration
          python_wheel_task:
            package_name: "oos_workflow"
            entry_point: "main"
            parameters: ["--env", "databricks"]
          
          # Install wheel package as library
          libraries:
            - whl: "../artifacts/default/dist/oos_workflow-0.1.0-py3-none-any.whl"
      
      # Job settings
      max_concurrent_runs: 1
      timeout_seconds: 3600
      email_notifications:
        on_failure: []
        on_success: []

# Define deployment targets
targets:
  dev:
    mode: development
    workspace:
      host: https://adb-<workspace-id>.azuredatabricks.net
      # Note: Authentication should be configured via Databricks CLI
      # Run: databricks configure --token
    
    resources:
      jobs:
        oos_workflow_job:
          # Override settings for dev environment
          name: "OOS Workflow Job (Dev)"
  
  prod:
    mode: production
    workspace:
      host: https://adb-<workspace-id>.azuredatabricks.net
    
    resources:
      jobs:
        oos_workflow_job:
          name: "OOS Workflow Job (Prod)"
          # Production-specific settings
          max_concurrent_runs: 3
          email_notifications:
            on_failure: ["team@example.com"]
